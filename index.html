<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Intraday XAU/USD 3EMA Quick Sheet</title>
<style>
:root{
  --primary-bg:#121212; --text:#fff; --accent:#ffd700; --accent-light:#ffe066;
  --card-bg:#1e1e1e; --button-bg:#ffd700; --button-hover:#ffec70;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;}
body{background:var(--primary-bg);color:var(--text);padding:20px;}
.container{max-width:720px;margin:auto;}
.card{background:var(--card-bg);border-radius:16px;padding:25px;margin-bottom:20px;box-shadow:0 8px 25px rgba(0,0,0,0.4);}
h2{margin-bottom:15px;font-weight:600;color:var(--accent);}
h3{margin:15px 0 8px;font-weight:500;color:var(--accent-light);}
.levels{display:grid;grid-template-columns:1fr 1fr;gap:10px 15px;margin-bottom:15px;}
.level{padding:10px 12px;border-radius:10px;display:flex;justify-content:space-between;font-weight:500;background:#2a2a2a;cursor:pointer;transition:.2s;user-select:text;}
.level:hover{background:#3a3a3a;color:var(--accent);}
.trade{padding:12px 15px;border-radius:12px;margin-bottom:10px;font-weight:500;cursor:pointer;transition:.2s;}
.long{background:var(--accent);color:#000;}
.short{background:#b8860b;color:#fff;}
.sideways{background:var(--accent-light);color:#000;}
.trade:hover{opacity:.85;transform:scale(1.02);}
.risk{margin-top:15px;padding:12px;border-radius:12px;background:#2a2a2a;color:#fff;}
button{padding:10px 18px;border:none;border-radius:8px;cursor:pointer;background:var(--button-bg);color:#000;font-weight:600;margin-top:10px;transition:.2s;margin-right:5px;margin-bottom:5px;}
button:hover{background:var(--button-hover);}
textarea, input{width:100%;margin-top:10px;padding:10px;border-radius:8px;background:#2a2a2a;color:#fff;border:none;font-family:monospace;font-size:14px;}
pre{background:#2a2a2a;padding:15px;border-radius:10px;overflow-x:auto;margin-top:15px;font-size:14px;color:#fff;}
table{width:100%;border-collapse:collapse;margin-top:15px;}
table,th,td{border:1px solid #444;}
th,td{padding:10px;text-align:center;}
th{background:#2a2a2a;color:var(--accent-light);}
</style>
</head>
<body>

<div class="container">
  <div class="card">
    <h2>Intraday XAU/USD 3EMA Quick Sheet</h2>
    <p><strong>Pair:</strong> <span id="pair"></span></p>
    <p><strong>Spot Price:</strong> <span id="spot"></span></p>
    <p><strong>Timestamp:</strong> <span id="timestamp"></span></p>
    <p><strong>Countdown:</strong> <span id="countdown">--:--:--</span></p>
    <p><strong>Bias:</strong> <span id="bias"></span></p>
    <p><strong>EMA Alignment:</strong> <span id="ema"></span></p>

    <h3>Level Kunci</h3>
    <div class="levels">
      <div class="level">Support Intraday<span id="sIntraday"></span></div>
      <div class="level">Support Kritis<span id="sKritis"></span></div>
      <div class="level">Resistance Intraday<span id="rIntraday"></span></div>
      <div class="level">Resistance Kuat<span id="rKuat"></span></div>
    </div>
    <button onclick="copyLevels()">ðŸ“‹ Salin Level</button>

    <h3>Quick Trade Triggers</h3>
    <div class="trade long" id="tLong"></div>
    <div class="trade short" id="tShort"></div>
    <div class="trade sideways" id="tSideways"></div>

    <div class="risk" id="riskText"></div>

    <h3>Fundamental Check</h3>
    <table>
      <tr>
        <th>Sentiment</th>
        <th>Risk</th>
        <th>Projection</th>
      </tr>
      <tr>
        <td id="sentiment"></td>
        <td id="risk"></td>
        <td id="projection"></td>
      </tr>
    </table>

    <h3>Kesimpulan</h3>
    <table>
      <tr>
        <th>Bias</th>
        <th>Strategy</th>
        <th>Notes</th>
      </tr>
      <tr>
        <td id="cBias"></td>
        <td id="cStrategy"></td>
        <td id="cNotes"></td>
      </tr>
    </table>

    <h3>Update / Import JSON</h3>
    <textarea id="jsonInput" placeholder="Paste JSON di sini untuk update..."></textarea>
    <input type="password" id="pinInput" placeholder="Masukkan PIN"/>
    <button onclick="updateRepo()">ðŸ”„ Update Repo</button>
  </div>
</div>

<script>
let countdownTimer;
const backendURL = 'http://localhost:3000/update-json'; // backend Node.js
const jsonURL = 'tradeData.json'; // file JSON di repo GitHub Pages

// --- Fetch JSON dari repo ---
async function fetchData() {
  try {
    const res = await fetch(jsonURL);
    if (!res.ok) throw new Error('Gagal load JSON');
    return await res.json();
  } catch (e) {
    console.error(e);
    return null;
  }
}

// --- Countdown ---
function startCountdown(validUntil) {
  clearInterval(countdownTimer);
  countdownTimer = setInterval(() => {
    const now = new Date();
    const end = new Date(validUntil);
    const diff = end - now;
    if (diff <= 0) {
      clearInterval(countdownTimer);
      document.getElementById('countdown').textContent = "Expired";
      return;
    }
    const h = String(Math.floor(diff/1000/60/60)).padStart(2,'0');
    const m = String(Math.floor((diff/1000/60)%60)).padStart(2,'0');
    const s = String(Math.floor((diff/1000)%60)).padStart(2,'0');
    document.getElementById('countdown').textContent = `${h}:${m}:${s}`;
  }, 1000);
}

// --- Update UI ---
function updateUI(data){
  document.getElementById("pair").textContent = data.pair;
  document.getElementById("spot").textContent = data.spot;
  document.getElementById("timestamp").textContent = new Date().toLocaleString();
  document.getElementById("bias").textContent = data.bias;
  document.getElementById("ema").textContent = data.emaAlignment;
  document.getElementById("sIntraday").textContent = data.levels.supportIntraday;
  document.getElementById("sKritis").textContent = data.levels.supportKritis;
  document.getElementById("rIntraday").textContent = data.levels.resistanceIntraday;
  document.getElementById("rKuat").textContent = data.levels.resistanceKuat;
  document.getElementById("tLong").textContent = `Long: Trigger ${data.quickTrade.long.trigger}, Entry ${data.quickTrade.long.entry}, TP ${data.quickTrade.long.tp}, SL ${data.quickTrade.long.sl}`;
  document.getElementById("tShort").textContent = `Short: ${data.quickTrade.short.trigger}, Entry ${data.quickTrade.short.entry}, TP ${data.quickTrade.short.tp}, SL ${data.quickTrade.short.sl}`;
  document.getElementById("tSideways").textContent = `Sideways: ${data.quickTrade.sideways.range}, ${data.quickTrade.sideways.strategy}`;
  document.getElementById("riskText").textContent = `Risk Management: ${data.risk}`;
  document.getElementById("sentiment").textContent = data.fundamental.sentiment;
  document.getElementById("risk").textContent = data.fundamental.risk;
  document.getElementById("projection").textContent = data.fundamental.projection;
  document.getElementById("cBias").textContent = data.conclusion.bias;
  document.getElementById("cStrategy").textContent = data.conclusion.strategy;
  document.getElementById("cNotes").textContent = data.conclusion.notes;
  startCountdown(data.validUntil);
}

// --- Copy level ---
function copyLevels() {
  const levels = [
    document.getElementById("sIntraday").textContent,
    document.getElementById("sKritis").textContent,
    document.getElementById("rIntraday").textContent,
    document.getElementById("rKuat").textContent
  ].join("\n");
  navigator.clipboard.writeText(levels).then(_ => alert("Key levels berhasil disalin!"));
}

// --- Update JSON via backend ---
async function updateRepo() {
  const pin = document.getElementById("pinInput").value;
  const jsonInput = document.getElementById("jsonInput").value;
  if (!pin || !jsonInput) return alert("Masukkan PIN dan JSON");

  try {
    const newData = JSON.parse(jsonInput);
    const res = await fetch(backendURL, {
      method: 'POST',
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ pin, newData })
    });
    const result = await res.json();
    alert(result.message);
  } catch(err) {
    console.error(err);
    alert("Gagal update JSON: " + err.message);
  }
}

// --- Initialize ---
(async ()=>{
  const data = await fetchData();
  if(data) updateUI(data);
})();
</script>

</body>
</html>
