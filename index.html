<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Trade Data Viewer</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #fafafa; }
    h1 { margin-bottom: 10px; }
    button { padding: 8px 12px; margin-bottom: 10px; border: none; border-radius: 6px; cursor: pointer; background: #007bff; color: #fff; font-size: 14px; }
    button:hover { background: #0056b3; }
    input { padding: 6px; width: 220px; margin: 10px 0; border: 1px solid #ccc; border-radius: 6px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; background: #fff; box-shadow: 0 2px 6px rgba(0,0,0,0.05); }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    th { background-color: #f0f0f0; cursor: pointer; }
    tr:nth-child(even) { background-color: #f9f9f9; }
    tr:hover { background-color: #f1f1f1; }
    #status { font-size: 13px; color: #555; margin-top: 5px; }
  </style>
</head>
<body>

<h1>üìä Trade Data</h1>
<button id="updateBtn">üîÑ Update Data</button>
<br>
<label for="searchInput">Filter:</label>
<input type="text" id="searchInput" placeholder="Ketik untuk mencari...">
<div id="status"></div>
<div id="tableContainer"></div>

<script>
const repoOwner = "kijangweb";
const repoName = "probpair";
const branch = "main";
const filePath = "tradeData.json";

let tradeData = [];
let currentSortKey = null;
let sortAsc = true;

// fetch JSON dari repo (pakai timestamp biar anti-cache)
async function loadData(showStatus = true) {
  try {
    const url = `https://raw.githubusercontent.com/${repoOwner}/${repoName}/${branch}/${filePath}?t=${Date.now()}`;
    const res = await fetch(url);
    if (!res.ok) throw new Error(`HTTP ${res.status}`);
    tradeData = await res.json();
    renderTable(tradeData);
    if (showStatus) updateStatus("‚úÖ Data terbaru berhasil dimuat");
  } catch (err) {
    updateStatus("‚ö†Ô∏è Gagal memuat data: " + err.message, true);
  }
}

// render tabel
function renderTable(data) {
  const container = document.getElementById("tableContainer");
  if (!Array.isArray(data) || data.length === 0) {
    container.innerHTML = "<p>Data kosong</p>";
    return;
  }

  const keys = Object.keys(data[0]);
  let html = "<table><thead><tr>";
  keys.forEach(key => {
    html += `<th onclick="sortTable('${key}')">${key}</th>`;
  });
  html += "</tr></thead><tbody>";

  data.forEach(obj => {
    html += "<tr>";
    keys.forEach(key => {
      html += `<td>${obj[key] !== undefined ? obj[key] : ""}</td>`;
    });
    html += "</tr>";
  });

  html += "</tbody></table>";
  container.innerHTML = html;
}

// sorting kolom
function sortTable(key) {
  if (currentSortKey === key) {
    sortAsc = !sortAsc;
  } else {
    currentSortKey = key;
    sortAsc = true;
  }

  tradeData.sort((a, b) => {
    if (a[key] < b[key]) return sortAsc ? -1 : 1;
    if (a[key] > b[key]) return sortAsc ? 1 : -1;
    return 0;
  });

  renderTable(tradeData);
}

// filter pencarian
document.getElementById("searchInput").addEventListener("input", e => {
  const q = e.target.value.toLowerCase();
  const filtered = tradeData.filter(obj =>
    Object.values(obj).some(val =>
      String(val).toLowerCase().includes(q)
    )
  );
  renderTable(filtered);
});

// status update
function updateStatus(msg, isError = false) {
  const el = document.getElementById("status");
  el.textContent = msg;
  el.style.color = isError ? "red" : "#555";
}

// update button
document.getElementById("updateBtn").addEventListener("click", () => loadData(true));

// load pertama kali (tanpa pesan status)
loadData(false);
</script>
</body>
</html>
